# ccusage Menubar App - プロジェクト現状報告

## 📋 プロジェクト概要
Claude使用量をメニューバーから簡単に確認できるElectronアプリ。ccusageコマンドの結果をリアルタイムで表示し、ユーザーフレンドリーなインターフェースを提供。

## ✅ 完了した機能・改善

### 1. 基本アプリケーション構築 ✅
- Electronベースのメニューバーアプリ
- システムトレイ常駐機能
- ccusageコマンドとの統合
- JSON データの取得・パース処理

### 2. コードアーキテクチャの改善 ✅
- **モジュール分割**: 責任分離による保守性向上
- **クラスベース設計**: OOP原則に従った実装
- **設定管理システム**: JSON設定ファイルのサポート
- **エラーハンドリング**: 包括的なエラー処理

### 3. UI/UXの大幅改善 ✅
- **モノクロ系デザイン**: シンプルで洗練された配色
- **美しいフォント**: Google Fonts Inter の採用
- **ホバー機能**: マウスオーバーで即座に情報表示
- **透明ポップアップ**: モダンな透明背景とドロップシャドウ

### 4. インタラクション機能 ✅
- **左クリック**: 詳細ポップアップ表示
- **右クリック**: コンテキストメニュー
- **ホバー**: ツールチップで使用量サマリー表示
- **自動更新**: 1分間隔でのデータ更新

### 5. ポップアップ位置調整 ✅
- **メニューバー直下配置**: アイコンの真下に正確に表示
- **クロスプラットフォーム対応**: macOS/Windows/Linux
- **画面端自動調整**: 画面外に出ない位置計算
- **中央揃え**: アイコン中心基準の配置

## 🏗️ 現在のアーキテクチャ

### ディレクトリ構造
```
ccusage-menubar/
├── src/
│   ├── main.js                 # メインプロセス・アプリケーション統合
│   ├── services/
│   │   ├── ccusageService.js    # ccusageコマンド実行・データ取得
│   │   └── AutoRefreshService.js # 自動更新機能
│   ├── managers/
│   │   ├── TrayManager.js       # システムトレイ・メニュー管理
│   │   └── WindowManager.js     # ポップアップウィンドウ管理
│   └── config/
│       └── AppConfig.js         # 設定ファイル読み書き
├── popup.html                   # ポップアップUI
├── package.json                 # プロジェクト設定
└── README.md                    # ユーザー向けドキュメント
```

### 主要クラスと責任
- **CcusageApp**: アプリケーション全体の統合・IPC管理
- **CcusageService**: ccusageコマンド実行・キャッシュ管理
- **TrayManager**: システムトレイ・ツールチップ・イベント処理
- **WindowManager**: ポップアップウィンドウ・位置計算
- **AppConfig**: 設定ファイル管理・デフォルト値
- **AutoRefreshService**: 自動更新・コールバック管理

## 🎨 現在のデザイン仕様

### カラーパレット
- **背景**: `#fafafa` (オフホワイト)
- **カード背景**: `#ffffff` (純白)
- **プライマリテキスト**: `#1a1a1a` (ダークグレー)
- **セカンダリテキスト**: `#666666` (ミディアムグレー)
- **ボーダー**: `#e1e1e1`, `#e8e8e8` (ライトグレー)
- **エラー**: `#d32f2f` (レッド)

### タイポグラフィ
- **フォントファミリー**: Inter (Google Fonts)
- **ウェイト**: 400 (Regular), 500 (Medium), 600 (SemiBold), 700 (Bold)
- **レターレーシング**: -0.01em ~ -0.02em
- **数値フォント**: `font-variant-numeric: tabular-nums`

### レイアウト
- **ポップアップサイズ**: 396x296px (マージン含む)
- **コンテンツエリア**: 380x280px
- **ボーダーレディウス**: 6-8px
- **シャドウ**: `0 12px 48px rgba(0, 0, 0, 0.18), 0 4px 16px rgba(0, 0, 0, 0.08)`

## ⚙️ 現在の設定

### デフォルト設定値
```json
{
  "cacheTimeout": 300000,        // 5分キャッシュ
  "autoRefresh": true,           // 自動更新有効
  "autoRefreshInterval": 60000,  // 1分間隔
  "showNotifications": true,     // 通知表示
  "theme": "auto",              // テーマ設定
  "startWithSystem": false,     // 自動起動
  "displayFormat": {
    "currency": "USD",          // 通貨
    "numberFormat": "en-US"     // 数値フォーマット
  }
}
```

## 🔧 開発・ビルド情報

### 依存関係
- **Electron**: ^28.3.3
- **Node.js**: 16+ 推奨
- **ccusage**: システムにインストール済み前提

### 起動コマンド
```bash
npm start              # 本番モード
npm run dev           # 開発モード（DevTools付き）
```

### ファイル監視
- 設定ファイル: `~/.config/ccusage-menubar/config.json`
- ログ出力: コンソールログ

## 🐛 既知の問題・制限事項

### 現在の制限
1. **ccusage依存**: システムにccusageがインストールされている必要
2. **ネットワーク**: Google Fonts読み込みでネット接続必要
3. **権限**: macOSでアクセシビリティ権限が必要な場合あり

### パフォーマンス考慮
- キャッシュ機能でAPI呼び出し頻度を制限
- 自動更新は最小限の処理で実装
- メモリリークなし

## 🚀 次回セッション用 TODO

### 優先度: 高
- [ ] アプリケーションのパッケージング（electron-builder）
- [ ] 自動起動機能の実装
- [ ] 設定画面UIの追加
- [ ] エラー通知システムの改善

### 優先度: 中
- [ ] 複数アカウント対応
- [ ] 使用量アラート機能
- [ ] データエクスポート機能
- [ ] ダークモード対応

### 優先度: 低
- [ ] 使用量グラフ表示
- [ ] 履歴データの保存
- [ ] プラグインシステム
- [ ] 多言語対応

## 🎯 次回セッション開始時のチェックリスト

1. **環境確認**
   ```bash
   cd /Users/ytr0/Desktop/cusage
   npm start  # 正常起動確認
   ```

2. **現在の機能テスト**
   - メニューバーアイコン表示確認
   - ホバーツールチップ動作確認
   - 左クリックポップアップ表示確認
   - 右クリックメニュー動作確認

3. **コード確認**
   - `src/main.js` - アプリケーション統合
   - `src/managers/TrayManager.js` - トレイ管理
   - `popup.html` - UI定義

4. **設定確認**
   - `~/.config/ccusage-menubar/config.json` 存在確認
   - ccusageコマンド動作確認: `npx ccusage daily --json`

## 📞 サポート・連絡先

### 開発環境
- **OS**: macOS (Darwin 24.5.0)
- **Node.js**: 推奨16+
- **IDE**: 任意（VS Code推奨）

### デバッグ方法
```bash
npm run dev  # DevTools付きで起動
```
コンソールでログ確認、ブレークポイント設定可能

---

**最終更新**: 2025-06-29
**バージョン**: 1.0.0
**ステータス**: 基本機能完成、拡張準備完了